# Generic USB Controller Translator (macOS)

A lightweight Python software that reads raw USB HID data from generic gamepads (like cheap SNES USB clones) and translates them into continuous keyboard inputs. 

This project was built specifically to bypass macOS's strict native GameController framework, allowing unsupported controllers to work perfectly on emulators like **Delta** or **RetroArch**.

## Features
* **Raw HID Reading:** Bypasses the OS and reads data directly from the USB port.
* **Auto-Detection:** Automatically scans and connects to gamepads (no hardcoding Vendor/Product IDs required).
* **Multiplayer Support:** Connect up to 2 USB controllers simultaneously with independent key mappings for each player.
* **Per-Player Key Mapping:** Each connected controller has its own customizable key map for flexible multiplayer gaming.
* **Automatic Controller Calibration:** Use the built-in `configurator.py` to auto-detect button mappings for any controller without manual configuration.
* **Hold-State Support:** Continuously spams the keystroke while a button is held down (essential for running/jumping in platformers like Super Mario).
* **Zero Input Lag:** Runs an optimized non-blocking loop for instantaneous response times.

## Prerequisites
Because this script simulates a virtual keyboard on macOS, you need a few system-level dependencies.

1. **Python 3.x** installed.
2. **Homebrew** (macOS package manager).
3. **C-Level HID Library:** macOS requires the underlying C library to read raw USB data.
   brew install hidapi



## Installation

1. Clone or download this repository.
2. (Optional but recommended) Create a virtual environment:
```bash
python3 -m venv .venv
source .venv/bin/activate

```


3. Install the required Python packages. *Note: We use the pre-compiled `hidapi` package instead of `hid` to prevent macOS missing library errors.*
```bash
pip install hidapi pynput

```



## ðŸŽ® Controller Calibration (Optional but Recommended)

If your controller buttons don't map correctly with the default configuration, use the automatic calibration tool:

```bash
python3 configurator.py

```

This will:
1. Auto-detect all connected controllers (up to 2).
2. Guide you through pressing each button to learn the button mappings.
3. Save the calibration data to `profiles.json`.

Once calibrated, the `translator.py` script can use these profiles for perfect button recognition on your specific controllers.

## Usage

1. **Plug in your USB Controller(s)** â€“ you can connect up to 2 controllers simultaneously.
2. Run the main script:
```bash
python3 main.py

```


3. **âš ï¸ CRITICAL MACOS STEP:** The first time you run this, macOS will block the script from simulating keyboard presses.
* Go to **System Settings > Privacy & Security > Accessibility**.
* Toggle the switch ON for your Terminal (or the Code Editor you are running the script from, e.g., VS Code or Sublime Text).
* Restart the script.


4. Minimize the terminal and open your emulator!

5. **For Multiplayer:** Once both controllers are plugged in, the script will automatically detect and assign them as Player 1 and Player 2, using separate key mappings for each.

## âš™ï¸ Configuration (Key Mapping)

You can easily customize which controller button presses which keyboard key. Open `main.py` and modify the `MAPS_PER_PLAYER` list. Each element in the list corresponds to a connected player:

```python
MAPS_PER_PLAYER = [
    { # PLAYER 1
        'up': 'w', 'down': 's', 'left': 'a', 'right': 'd',
        'A': 'l', 'B': 'k', 'X': 'i', 'Y': 'j',
        'L': 'q', 'R': 'e', 'start': Key.enter, 'select': Key.space
    },
    { # PLAYER 2
        'up': Key.up, 'down': Key.down, 'left': Key.left, 'right': Key.right,
        'A': 'v', 'B': 'c', 'X': 'f', 'Y': 'x',
        'L': '1', 'R': '2', 'start': '3', 'select': '4'
    }
]
```

**Note:** The system supports up to 2 players. Add or remove player mappings as needed. Use regular characters like `'w'` or `Key.enter` for special keys.

## File Structure

* `main.py`: The core multiplayer loop. Handles independent state memory for each player and triggers virtual keyboard presses using `pynput`.
* `controllerGetter.py`: Contains the auto-detection logic (`hid.enumerate()`) to find and connect to available gamepads automatically based on keyword matching.
* `translator.py`: Alternative implementation with multiplayer support built-in for streamlined controller-to-keyboard translation.
* `configurator.py`: Universal controller calibration tool that automatically detects button mappings for any controller and generates profiles.
* `profiles.json`: Stores calibrated button mappings for up to 2 controllers (generated by `configurator.py`).
* `profile.json`: Legacy single-player profile file.
* `mappingAndTesting/` directory:
  * `mapping.py`: Reference documentation showing the raw HID data patterns for each controller button and combination.
  * `unlimitedOutputs.py`: Debugging utility to display raw HID data received from a specific controller (useful for reverse-engineering unmapped controllers).
  * `mappingInputs.py`: Testing tool for input validation and mapping verification.

## Troubleshooting

* **`ImportError: Unable to load any of the following libraries: libhidapi.dylib`**: You installed the `hid` package instead of `hidapi`, or you forgot to run `brew install hidapi`. Run `pip uninstall hid` followed by `pip install hidapi`.
* **The terminal says "Pressed" but the game isn't responding:** You haven't granted Accessibility permissions in macOS System Settings.
* **The character only moves one step when I hold the D-pad:** Ensure you are using the latest version of `main.py` which includes the "Forced Hold" logic (bypassing macOS's default key-repeat disabling).
* **My second controller isn't detected:** Make sure both controllers are plugged in before running the script. The system detects available controllers at startup. If detection fails, verify they appear in `System Information > USB`.
* **Player 2 inputs are not working:** Check that you've customized the `MAPS_PER_PLAYER` list with appropriate key bindings for Player 2 in `main.py`.
* **Button presses aren't being detected correctly:** Run `configurator.py` to auto-calibrate your controller's button mappings. This works with any controller model.
* **Need to debug controller inputs?** Use `unlimitedOutputs.py` in the `mappingAndTesting/` directory to see raw HID data from your controller and verify button mappings.

